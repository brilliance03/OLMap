<!DOCTYPE html>
<html>
<head lang="zh">
    <meta charset="UTF-8">
    <title>WebGIS</title>
    <link rel="stylesheet" href="../css/ol.css" type="text/css">
    <link rel="stylesheet" href="../css/font-awesome/css/font-awesome.min.css" type="text/css">
    <link rel="stylesheet" href="../css/map.css" type="text/css">

    <script src="../scripts/ol-debug.js" type="text/javascript"></script>
    <script src="../scripts/jquery-1.11.1.min.js" type="text/javascript"></script>

</head>
<body>
<div id="map"></div>
<div id="mousePosition" class="ol-unselectable"></div>
<div id="layerGroupMenuBar" class="ol-unselectable">
    <button class="btnLayerChoose" id="btnBaseMap" value="baseMap">行政区划地图</button>
    <button class="btnLayerChoose" id="btnAerialMap" value="aerialMapBing" title="此图层需要互联网连接才可显示">卫星图</button>
    <button class="btnLayerChoose" id="btnAerialLabelMap" value="aerialWithLabelMapBing" title="此图层需要互联网连接才可显示">标注卫星图</button>
</div>
<div class="ol-unselectable bizMenuBar">
    <div class="btnBizMenu">
        <a href="javascript:;" id="lnkDisasterLocation" title="灾害地点定位">
            <i class="fa fa-lg fa-bullseye menu-icon-red"></i>
            <span>灾害地点定位</span>
        </a>
    </div>
    <div class="btnBizMenu">
        <a href="javascript:;" title="应急资源分布">
            <i class="fa fa-lg fa-image"></i>
            <span>应急资源分布</span>
        </a>
    </div>
    <div class="btnBizMenu">
        <a href="javascript:;" title="区域详细信息">
            <i class="fa fa-lg fa-info"></i>
            <span>区域详细信息</span>
        </a>
    </div>
    <div class="btnBizMenu">
        <a href="javascript:;" title="物资需求分析">
            <i class="fa fa-lg fa-calculator"></i>
            <span>物资需求分析</span>
        </a>
    </div>
    <div class="btnBizMenu">
        <a href="javascript:;" title="应急调度">
            <i class="fa fa-lg fa-phone"></i>
            <span>应急调度</span>
        </a>
    </div>
    <div class="btnBizMenu">
        <a href="javascript:;" title="救援路径分析">
            <i class="fa fa-lg fa-road"></i>
            <span>救援路径分析</span>
        </a>
    </div>
    <div class="btnBizMenu">
        <a href="javascript:;" title="态势标绘">
            <i class="fa fa-lg fa-exchange"></i>
            <span>态势标绘</span>
        </a>
    </div>
    <div class="btnBizMenu">
        <a href="javascript:;" title="自由标绘">
            <i class="fa fa-lg fa-paint-brush"></i>
            <span>自由标绘</span>
        </a>
    </div>
    <div class="btnBizMenu">
        <a href="javascript:;" title="定位">
            <i class="fa fa-lg fa-map-marker"></i>
            <span>定位</span>
        </a>
    </div>
    <div class="btnBizMenu">
        <a href="javascript:;" title="统计分析">
            <i class="fa fa-lg fa-bar-chart"></i>
            <span>统计分析</span>
        </a>
    </div>
</div>

<script type="text/javascript">
    /**********************************************************
     * 定义全局变量
     **********************************************************/
     var projection = {}; //定义使用的投影系
     var layers = {}; //定义图层集合

    /**********************************************************
     * 定义页面控件
     **********************************************************/
     //定义比例尺
    var scaleLineControl = new ol.control.ScaleLine();
    //定义鼠标位置
    var mousePositionControl = new ol.control.MousePosition({
        coordinateFormat: ol.coordinate.createStringXY(4),
        projection: 'EPSG:4326',
        target: $('#mousePosition')[0],
        undefinedHTML: '暂无坐标'
    });
    // 滑动设置缩放等级
    var zoomslider = new ol.control.ZoomSlider();

    /**********************************************************
     * 定义视图
     **********************************************************/
    var mapView = new ol.View({
        center: ol.proj.transform([116.42, 39.88], 'EPSG:4326', 'EPSG:3857'),
        zoom: 4,
        minZoom: 2,
        maxZoom: 28
    });

    /**********************************************************
     * 定义栅格图层
     **********************************************************/
    layers.baseMap = new ol.layer.Tile({
        source: new ol.source.XYZ({
            url: 'http://emap{1-3}.mapabc.com/mapabc/maptile?&x={x}&y={y}&z={z}',
            attributions: [
                new ol.Attribution({
                    html: '交付中心 © ' +
                            '<a href="http://www.sinosoft.com.cn/">中科软科技股份有限公司</a>'
                })
             ]
        })
    }); //定义底图层

    layers.aerialMapBing = new ol.layer.Tile({
        //source: new ol.source.MapQuest({layer: 'sat'})
        source: new ol.source.BingMaps({
            culture: 'zh-cn',
            key: 'AhARYbXRzUHxE7zdTbmnZOiHoa_DK6FdOoq1pFbq6MLiA3qOkMALx7YqmVnjqnBs',
            imagerySet: 'Aerial'
        })
    }); //定义卫星图层,使用Bing地图

    layers.aerialWithLabelMapBing = new ol.layer.Tile({
        //source: new ol.source.MapQuest({layer: 'sat'})
        source: new ol.source.BingMaps({
            culture: 'zh-cn',
            key: 'AhARYbXRzUHxE7zdTbmnZOiHoa_DK6FdOoq1pFbq6MLiA3qOkMALx7YqmVnjqnBs',
            imagerySet: 'AerialWithLabels'
        })
    }); //定义带标注的卫星图层,使用Bing地图

    var baseMapGroup = new ol.layer.Group({
        layers: [
                    layers.baseMap,
                    layers.aerialMapBing,
                    layers.aerialWithLabelMapBing
                ]
    }); //定义底图组，支持切换不同底图

    /**********************************************************
     * 定义矢量图层
     **********************************************************/
     /*layers.provinceBound = new ol.layer.GeoJSON({

     });*/

    /**********************************************************
     * 定义操作菜单按钮
     **********************************************************/
    //定义图层切换按钮的点击事件
    $('#layerGroupMenuBar>button').click(function(){
        var value = this.value;
        for(key in layers){
            layers[key].setVisible(key == value ? true : false);
        }
        $.each($('#layerGroupMenuBar>button'),function(index,element){
            changeStyle(element.id, element.value == value ? 'btnLayerChooseAfterClick' : 'btnLayerChoose');
        });
    });//设定按钮切换方法

    //定义业务菜单按钮的点击事件
    $('#lnkDisasterLocation').on('click',function(){
        alert(this.title);
    });//灾害地点定位


    /**********************************************************
     * 合成地图、初始化操作
     **********************************************************/
    var map = new ol.Map({
        controls: ol.control.defaults({
            attributionOptions: ({
                collapsible: true
            })
        }).extend([
            zoomslider,
            scaleLineControl,
            mousePositionControl
        ]),
        layers: [
            baseMapGroup
        ],
        view: mapView,
        target: 'map'
    });

    $.each($('button.btnLayerChoose'), function () {
        if(this.value == 'baseMap'){
            this.click();
        }
    })//图层选择按钮初始化设定，默认显示行政区划地图

    //http://localhost/cgi-bin/mapserv?map=/var/www/cgi-bin/mapserver/mapserver_china.map&service=wfs&request=getfeature&version=1.0.0&maxfeatures=50&typename=provinces_simplify&outputformat=application/json

    /**********************************************************
     * 公共方法
     **********************************************************/
    function changeStyle(domId,styleName){
        $("#" + domId).removeClass();
        $("#" + domId).addClass(styleName);
    }
</script>
</body>
</html>