<!DOCTYPE html>
<html>
<head lang="zh">
    <meta charset="UTF-8">
    <title>WebGIS</title>
    <link rel="stylesheet" href="../css/ol.css" type="text/css">

    <script src="../scripts/ol-debug.js" type="text/javascript"></script>
    <script src="../scripts/jquery-1.11.1.min.js" type="text/javascript"></script>

    <style type="text/css">
        html,body
        {
            height: 100%; margin: 0; padding: 0;
        }
        #map
        {
            height: 100%; width: 100%; position:absolute; top:0; bottom:0;
        }
        #map .ol-zoom .ol-zoom-out {
            margin-top: 202px;
        }
        #map .ol-zoomslider {
            background-color: transparent; top: 2.3em;
        }

        #map .ol-touch .ol-zoom .ol-zoom-out {
            margin-top: 212px;
        }
        #map .ol-touch .ol-zoomslider {
            top: 2.75em;
        }
        #mousePosition {
            width: 125px;
            height: 33px;
            text-align: left;
            font-size: 14px;
            background: rgba(0, 60, 136, .3);
            border-radius: 4px;
            bottom: 35px;
            left: 8px;
            padding: 0 2px;
            position: absolute;
            border: 1px solid #eee;
            border-top: none;
            color: #eee;
            margin: 1px;
        }
        #layerGroupMenu {
            position: absolute;
            top: .5em;
            left: 40%;
        }
        .btnLayerChoose {
            border-radius: 4px;
            height: 25px;
            width: 100px;
            background: rgba(0, 60, 136, .5);
            color: #FFFFFF;
            font-size: 14px;
            font-weight: 700;
            margin: 1px;
            padding: 0;
            line-height: .4em;
            border: none;

        }
        .btnLayerChoose:focus {
            background: rgba(255, 255, 255, .7);
            color: rgba(0, 60, 136, .7);
        }
        .btnLayerChoose:visited {
            background: rgba(255, 255, 255, .7);
            color: rgba(0, 60, 136, .7);
        }
        .btnLayerChoose:hover {
            background: rgba(0, 60, 136, .7);
            color: #FFFFFF;
        }
        .btnLayerChoose:active {
            background: rgba(255, 255, 255, .7);
            color: rgba(0, 60, 136, .7);
        }

        #bizMenu{
            position: absolute;
            top: .5em;
            right: .5em;
        }

    </style>
</head>
<body>
<div id="map"></div>
<div id="mousePosition" class="ol-unselectable"></div>
<div id="layerGroupMenu" class="ol-unselectable"></div>
<div id="bizMenu" class="ol-unselectable"></div>

<script type="text/javascript">
    /**********************************************************
     * 定义全局变量
     **********************************************************/
     var projection = {}; //定义使用的投影系
     var layers = {}; //定义图层集合

    /**********************************************************
     * 定义页面控件
     **********************************************************/
     //定义比例尺
    var scaleLineControl = new ol.control.ScaleLine();
    //定义鼠标位置
    var mousePositionControl = new ol.control.MousePosition({
        coordinateFormat: ol.coordinate.createStringXY(4),
        projection: 'EPSG:4326',
        target: $('#mousePosition')[0],
        undefinedHTML: '暂无坐标'
    });
    // 滑动设置缩放等级
    var zoomslider = new ol.control.ZoomSlider();

    /**********************************************************
     * 定义视图
     **********************************************************/
    var mapView = new ol.View({
        center: ol.proj.transform([39.41, 48.82], 'EPSG:4326', 'EPSG:3857'),
        zoom: 4,
        minZoom: 2,
        maxZoom: 13
    });

    /**********************************************************
     * 定义栅格图层
     **********************************************************/
    layers.baseMap = new ol.layer.Tile({
        source: new ol.source.XYZ({
            url: 'http://emap{1-3}.mapabc.com/mapabc/maptile?&x={x}&y={y}&z={z}',
            attributions: [
                new ol.Attribution({
                    html: '交付中心 © ' +
                            '<a href="http://www.sinosoft.com.cn/">中科软科技股份有限公司</a>'
                })
             ]
        })
    }); //定义底图层

    layers.aerialMapBing = new ol.layer.Tile({
        //source: new ol.source.MapQuest({layer: 'sat'})
        source: new ol.source.BingMaps({
            culture: 'zh-cn',
            key: 'AhARYbXRzUHxE7zdTbmnZOiHoa_DK6FdOoq1pFbq6MLiA3qOkMALx7YqmVnjqnBs',
            imagerySet: 'Aerial'
        })
    }); //定义卫星图层,使用Bing地图

    layers.aerialWithLabelMapBing = new ol.layer.Tile({
        //source: new ol.source.MapQuest({layer: 'sat'})
        source: new ol.source.BingMaps({
            culture: 'zh-cn',
            key: 'AhARYbXRzUHxE7zdTbmnZOiHoa_DK6FdOoq1pFbq6MLiA3qOkMALx7YqmVnjqnBs',
            imagerySet: 'AerialWithLabels'
        })
    }); //定义带标注的卫星图层,使用Bing地图

    var baseMapGroup = new ol.layer.Group({
        layers: [
                    layers.baseMap,
                    layers.aerialMapBing,
                    layers.aerialWithLabelMapBing
                ]
    }); //定义底图组，支持切换不同底图

    /**********************************************************
     * 定义矢量图层
     **********************************************************/
     /*layers.provinceBound = new ol.layer.GeoJSON({

     });*/

    /**********************************************************
     * 定义操作菜单
     **********************************************************/
    $('#layerGroupMenu').append('<button class="btnLayerChoose" value="baseMap">行政区划地图</button>');
    $('#layerGroupMenu').append('<button class="btnLayerChoose" value="aerialMapBing">卫星图</button>');
    $('#layerGroupMenu').append('<button class="btnLayerChoose" value="aerialWithLabelMapBing">标注卫星图</button>');

    $('button.btnLayerChoose').click(function(){
        var flgVisiable = false;
        for(var key in layers){
            if(key == this.value){
                flgVisiable = true;
            }else{
                flgVisiable = false;
            }
            layers[key].setVisible(flgVisiable);
    }
    });//设定按钮切换方法

    $.each($('button.btnLayerChoose'), function () {
        if(this.value == 'baseMap'){
            this.click();
            this.focus();
        }
    })//初始化设定，默认显示行政区划地图

    /**********************************************************
     * 合成地图
     **********************************************************/

    var map = new ol.Map({
        controls: ol.control.defaults({
            attributionOptions: ({
                collapsible: true
            })
        }).extend([
            zoomslider,
            scaleLineControl,
            mousePositionControl
        ]),
        layers: [
            baseMapGroup
        ],
        view: mapView,
        target: 'map'
    });

    //http://localhost/cgi-bin/mapserv?map=/var/www/cgi-bin/mapserver/mapserver_china.map&service=wfs&request=getfeature&version=1.0.0&maxfeatures=50&typename=provinces_simplify&outputformat=application/json


</script>
</body>
</html>