<!DOCTYPE html>
<html>
<head lang="zh">
    <meta charset="UTF-8">
    <title>WebGIS</title>
    <link rel="stylesheet" href="../css/ol.css" type="text/css">
    <link rel="stylesheet" href="../css/font-awesome/css/font-awesome.min.css" type="text/css">
    <link rel="stylesheet" href="../css/map.css" type="text/css">
    <link rel="stylesheet" href="../css/ele.css" type="text/css">
    <link rel="stylesheet" href="../css/jquery.qtip.min.css" type="text/css">
    <link rel="stylesheet" href="../scripts/layer/skin/layer.css" type="text/css">
    <link rel="stylesheet" href="../plugin/lightbox/css/lightbox.css" type="text/css">
    <style type="text/css">
        .xubox_layer {
            z-index: 999 !important;
        }
    </style>
</head>
<body>
<div id="map">
</div>
<div id="mapOperationBar" class="ol-unselectable">
    <a href="#" id="mapOperation"><i class="fa fa-globe"></i></a>
</div>
<div style="display: none">
    <fieldset>
        <legend>测量</legend>
        <a href="javascript:;" id="measureDistance">测量距离</a>
        <a href="javascript:;" id="measureArea">测量面积</a>
    </fieldset>
    <p/>
    <fieldset>
        <legend>标绘</legend>
        <a href="javascript:;" id="drawPoint">绘制点</a>
        <a href="javascript:;" id="drawLine">绘制线</a>
        <a href="javascript:;" id="drawPoly">绘制多边形</a>
    </fieldset>
    <p/>
    <fieldset>
        <legend>路径</legend>
        <a href="javascript:;" id="routing">路径分析</a>
        <a href="javascript:;" id="clearRouting">清除路径</a>
    </fieldset>
</div>
<div id="mousePosition" class="ol-unselectable"></div>
<div id="layerGroupMenuBar" class="ol-unselectable">
    <button class="btnLayerChoose" id="btnBaseMap" value="baseMap">行政区划地图</button>
    <button class="btnLayerChoose" id="btnAerialMap" value="aerialMapBing" title="此图层需要互联网连接才可显示">卫星图</button>
    <button class="btnLayerChoose" id="btnAerialLabelMap" value="aerialWithLabelMapBing" title="此图层需要互联网连接才可显示">标注卫星图</button>
</div>
<div id="dataLocateBar" class="ol-unselectable">
    <ul>
        <li><a href="#" class="dropdown" title="提供数据信息的标点定位功能"><span>标点定位</span><i class="fa fa-angle-double-down" style="color: white"></i></a></li>
        <li class="sublinks">
            <a href="#" id="locateDisaster"><i class="fa fa-bullseye"></i><span>灾情标点</span></a>
            <a href="#" id="locateWarehouse"><i class="fa fa-home"></i><span>物资库标点</span></a>
            <a href="#" id="locateHiddenTrouble"><i class="fa fa-warning"></i><span>地质灾害隐患点标点</span></a>
            <a href="#" id="locateShelters"><i class="fa fa-group"></i><span>避难场所标点</span></a>
        </li>
    </ul>
</div>
<!--侧边栏-->
<div id="eastnav-left">
    <div class="left-title">
        <div class="left-title-bg" id="zqlb">
            <span class="left-title-icon"><i class="fa fa-bars"></i></span>
            <span class="left-title-word">灾情列表</span>
        </div>
    </div>
    <div class="left-title">
        <div class="left-title-bg" id="zycx">
            <span class="left-title-icon"><i class="fa fa-search"></i></span>
            <span class="left-title-word">资源查询</span>
        </div>
    </div>
    <div class="left-title">
        <div class="left-title-bg" id="jcxx">
            <span class="left-title-icon"><i class="fa fa-info"></i></span>
            <span class="left-title-word">基础信息</span>
        </div>
    </div>
    <div class="left-title" style="display: none">
        <div class="left-title-bg" id="ztt">
            <span class="left-title-icon"><i class="fa fa-picture-o"></i></span>
            <span class="left-title-word">专题图</span>
        </div>
    </div>
    <div id="exit"><i class="fa fa-arrow-right"></i></div>
</div>
<div id="eastnav-right">
    <div class="right-menu" data-url="zqlb">
        <div class="row">
            <input type="checkbox" id="chkDisasterLayerShow"/>
            <span class="menu-title">灾情定位图层</span>
        </div>
        <div class="row">
            <span class="span-title">灾情名称</span>
            <input type="text" class="gis-input" style="width: 150px" id="data_disasterName"/>
        </div>
        <div class="row">
            <span class="span-title">灾情种类</span>
            <select id="data_resourceTypes" class="gis-select" style="width: 150px" name="data_resourceType">
                <option value="">干旱</option>
                <option value="">洪涝</option>
                <option value="">冰雹</option>
            </select>
        </div>
        <div class="row">
            <a class="gis-btn" style="margin-left: 70px;">查询</a>
        </div>
        <table class="gis-table">
            <tr>
                <th></th>
                <th>灾害种类</th>
                <th>灾害发生时间</th>
            </tr>
            <tr>
                <td class="table-icons"><input type="radio" name="slecDisaster" value="0"/></td>
                <td>洪涝</td>
                <td>2014-10-09 10:40:40</td>
            </tr>
            <tr>
                <td class="table-icons"><input type="radio" name="slecDisaster" value="1"/></td>
                <td>干旱</td>
                <td>2014-07-02 08:21:23</td>
            </tr>
            <tr>
                <td class="table-icons"><input type="radio" name="slecDisaster" value="2"/></td>
                <td>冰雹</td>
                <td>2014-03-11 09:42:23</td>
            </tr>
            <tr>
                <td class="table-icons"><input type="radio" name="slecDisaster" value="3"/></td>
                <td>冰雹</td>
                <td>2014-02-12 02:20:12</td>
            </tr>
            <tr>
                <td class="table-icons"><input type="radio" name="slecDisaster" value="4"/></td>
                <td>干旱</td>
                <td>2013-09-20 12:23:12</td>
            </tr>
        </table>
    </div>
    <div class="right-menu" data-url="zycx">
        <div class="row">
            <input type="checkbox" id="chkWarehouseLayerShow"/>
            <span class="menu-title">物资库图层</span><br>
            <input type="checkbox" id="chkSheltersLayerShow"/>
            <span class="menu-title">应急避难场所图层</span><br>
            <input type="checkbox" id="chkExpertLayerShow"/>
            <span class="menu-title">应急专家</span><br>
            <input type="checkbox" id="chkRescueTeamLayerShow"/>
            <span class="menu-title">救援队伍</span><br>
            <input type="checkbox" id="chkMessengerLayerShow"/>
            <span class="menu-title">灾害信息员</span><br>
        </div>
        <div class="row">
            <span class="span-title">资源名称</span>
            <input type="text" class="gis-input" style="width: 150px" id="data_resourceName"/>
        </div>
        <div class="row">
            <span class="span-title">资源类型</span>
            <select id="data_resourceType" name="data_resourceType" style="width: 150px" class="gis-select">
                <option value="">物资库</option>
                <option value="">应急避难场所</option>
                <option value="">应急专家</option>
                <option value="">救援队伍</option>
                <option value="">灾害信息员</option>
            </select>
        </div>
        <div class="row">
            <a class="gis-btn" style="margin-left: 70px;">查询</a>
        </div>
    </div>
    <div class="right-menu" data-url="jcxx">
        <div class="row">
            <input type="checkbox" id="chkBaseInfoLayerShow"/>
            <span class="menu-title">基础信息图层</span><br>
            <input type="checkbox" id="chkHiddenTroubleLayerShow"/>
            <span class="menu-title">地质灾害隐患点图层</span>bv
        </div>
        <div class="row" id="basicInfoChoosen" style="display: none">
            <a id="lnkPopulationWinShow" href="javascript:void(0);"><span class="menu-title">人口</span></a><br>
            <a id="lnkFloorAreaWinShow" href="javascript:void(0);"><span class="menu-title">占地面积 </span></a><br>
            <a id="lnkArableAreaWinShow" href="javascript:void(0);"><span class="menu-title">耕地面积</span></a><br>
            <a id="lnkGrassLandWinShow" href="javascript:void(0);"><span class="menu-title">草场面积</span></a><br>
            <a id="lnkGDPWinShow" href="javascript:void(0);"><span class="menu-title">生产总值</span></a><br>
            <a id="lnkAltitudeWinShow" href="javascript:void(0);"><span class="menu-title">海拔高度</span></a><br>
        </div>
    </div>
    <div class="right-menu" data-url="ztt">
        <a>专题图</a>
    </div>
</div>
<!--鼠标业务菜单-->
<div id="bizDisaster">
    <!--灾情相关业务-->
    <div class="radius"><i class="fa fa-bars" title="查看灾情详细信息"></i></div>
    <div class="radius"><i class="fa fa-picture-o" title="查看灾情现场资料"></i></div>
    <!--<div class="radius"><i class="fa fa-film" title="查看灾情视频"></i></div>-->
    <div class="radius"><i class="fa fa-cloud" title="查看受灾地需求"></i></div>
    <div class="radius"><i class="fa fa-envelope" title="查看受灾地救灾工作"></i></div>
    <div class="radius"><i class="fa fa-cubes" title="查看涉灾部门数据"></i></div>
    <!--<div class="radius"><i class="fa fa-search" title="查询周边"></i></div>-->
    <div class="radius"><i class="fa fa-newspaper-o" title="查看灾情研判结果"></i></div>
    <div class="radius"><i class="fa fa-users" title="决策"></i></div>
    <div class="radius"><i class="fa fa-search" title="查询周边"></i></div>
    <div class="arrow arrow-01"></div>
    <div class="arrow arrow-02"></div>
    <div class="arrow arrow-03"></div>
    <div class="arrow arrow-04"></div>
    <div class="arrow arrow-05"></div>
    <div class="arrow arrow-06"></div>
</div>
<!--业务页面代码-->
<div id="locateDisasterWindow" class="bizWindow displayNone">
    <div class="page">
        <div class="page-title">
            <p><i class="fa fa-th-list"></i>未标点灾情</p>
        </div>
        <table class="gis-table" style="width: 390px;">
            <tr>
                <th></th>
                <th>灾情标题</th>
                <th>灾害种类</th>
                <th>受灾区域</td>
            </tr>
            <tr>
                <td class="table-icons"><input type="radio" name="locDisaster" value=""/></td>
                <td>甘肃省兰州市城关区于2014-03-05 03:32:32发生干旱10人死亡</td>
                <td>干旱</td>
                <td>城关区</td>
            </tr>
            <tr>
                <td class="table-icons"><input type="radio" name="locDisaster" value=""/></td>
                <td>甘肃省金昌市永昌县于2014-04-07 08:42:32发生风雹18人死亡</td>
                <td>风雹</td>
                <td>永昌县</td>
            </tr><tr>
                <td class="table-icons"><input type="radio" name="locDisaster" value=""/></td>
                <td>甘肃省平凉市泾川县于2014-04-15 07:14:38发生泥石流10人死亡</td>
                <td>泥石流</td>
                <td>泾川县</td>
            </tr>

        </table>
        <a class="gis-btn" style="margin-top: 10px" id="disasterLocate">标点</a>
    </div>
</div>
<div id="locateWarehouseWindow" class="bizWindow displayNone">
    <div class="page">
        <div class="page-title">
            <p><i class="fa fa-th-list"></i>未标点物资库</p>
        </div>
        <table class="gis-table" style="width: 390px;">
            <tr>
                <th></th>
                <th>仓库名称</th>
                <th>仓库级别</th>
                <th>地址</th>
            </tr>
            <tr>
                <td class="table-icons"><input type="radio" name="locWarehouse" value=""/></td>
                <td>甘肃省救灾物资储备库</td>
                <td>国家级</td>
                <td>兰州市榆中县小桥大街20号</td>
            </tr>
            <tr>
                <td class="table-icons"><input type="radio" name="locWarehouse" value=""/></td>
                <td>甘肃省救灾物资储备库</td>
                <td>省级</td>
                <td>白银市靖远县小桥大街20号</td>
            </tr>
            <tr>
                <td class="table-icons"><input type="radio" name="locWarehouse" value=""/></td>
                <td>甘肃省救灾物资储备库</td>
                <td>州市级</td>
                <td>威武市古浪县沙洲镇大街9号</td>
            </tr>
        </table>
        <a class="gis-btn" style="margin-top: 10px;" id="warehouseLocate">标点</a>
    </div>
</div>
<div id="locateHiddenTroubleWindow" class="bizWindow displayNone">
    <div class="page">
        <div class="page-title">
            <p><i class="fa fa-th-list"></i>未标点地质灾害隐患点</p>
        </div>
        <table class="gis-table" style="width: 390px;">
            <tr>
                <th></th>
                <th>隐患点名称</td>
                <th>隐患点类别</td>
                <th>地址</td>
            </tr>
            <tr>
                <td class="table-icons"><input type="radio" name="locHiddenTrouble" value=""/></td>
                <td>隐患点1</td>
                <td>类别1</td>
                <td>地址1</td>
            </tr>
            <tr>
                <td class="table-icons"><input type="radio" name="locHiddenTrouble" value=""/></td>
                <td>隐患点2</td>
                <td>类别2</td>
                <td>地址2</td>
            </tr>
            <tr>
                <td class="table-icons"><input type="radio" name="locHiddenTrouble" value=""/></td>
                <td>隐患点3</td>
                <td>类别3</td>
                <td>地址3</td>
            </tr>
        </table>
        <a class="gis-btn" style="margin-top: 10px" id="hiddenTroubleLocate">标点</a>
    </div>
</div>
<div id="locateSheltersWindow" class="bizWindow displayNone">
    <div class="page">
        <div class="page-title">
            <p><i class="fa fa-th-list"></i>未标点避难场所</p>
        </div>
        <table class="gis-table" style="width: 390px;">
            <tr>
                <th></th>
                <th>避难场所名称</th>
                <th>避难场所类型</th>
                <th>行政区划</th>
            </tr>
            <tr>
                <td class="table-icons"><input type="radio" name="locShelters" value=""/></td>
                <td>东方红广场</td>
                <td>广场</td>
                <td>甘肃省兰州市永登县</td>
            </tr>
            <tr>
                <td class="table-icons"><input type="radio" name="locShelters" value=""/></td>
                <td>白塔山公园</td>
                <td>公园</td>
                <td>甘肃省天水市麦积区</td>
            </tr>
            <tr>
                <td class="table-icons"><input type="radio" name="locShelters" value=""/></td>
                <td>伏羲广场</td>
                <td>绿地</td>
                <td>甘肃省酒泉市金塔县</td>
            </tr>
        </table>
        <a class="gis-btn" style="margin-top: 10px" id="sheltersLocate">标点</a>
    </div>
</div>

<!--查询周边页面-->
<div class="displayNone" id="pageCxzb" style="width: 500px; padding: 8px">
    <div class="row">
        <span class="span-title">灾情名称</span>
        <input type="text" class="gis-input" id="data_disasterName"/>
    </div>
    <div class="row">
        <span class="span-title">灾情种类</span>
        <select id="data_resourceTypes" class="gis-select" name="data_resourceType">
            <option value="">干旱</option>
            <option value="">洪涝</option>
            <option value="">冰雹</option>
        </select>
    </div>
    <div class="row">
        <a class="gis-btn" style="margin-left: 70px;">查询</a>
    </div>
    <table class="gis-table">
        <tr>
            <th></th>
            <th>灾害种类</th>
            <th>灾害发生时间</th>
        </tr>
        <tr>
            <td class="table-icons"><input type="radio" name="slecDisaster" value="0"/></td>
            <td>洪涝</td>
            <td>2014-10-09 10:40:40</td>
        </tr>
        <tr>
            <td class="table-icons"><input type="radio" name="slecDisaster" value="1"/></td>
            <td>干旱</td>
            <td>2014-07-02 08:21:23</td>
        </tr>
        <tr>
            <td class="table-icons"><input type="radio" name="slecDisaster" value="2"/></td>
            <td>冰雹</td>
            <td>2014-03-11 09:42:23</td>
        </tr>
        <tr>
            <td class="table-icons"><input type="radio" name="slecDisaster" value="3"/></td>
            <td>冰雹</td>
            <td>2014-02-12 02:20:12</td>
        </tr>
        <tr>
            <td class="table-icons"><input type="radio" name="slecDisaster" value="4"/></td>
            <td>干旱</td>
            <td>2013-09-20 12:23:12</td>
        </tr>
    </table>
</div>

<!--灾情图片临时测试-->
<div id="imgs" style="display:none">
    <img src="data/picture/1.jpg" layer-img="data/picture/1.jpg" alt="灾情图片">
    <img src="data/picture/2.jpg" layer-img="data/picture/2.jpg" alt="灾情图片">
    <img src="data/picture/3.jpg" layer-img="data/picture/3.jpg" alt="灾情图片">
    <img src="data/picture/4.jpg" layer-img="data/picture/4.jpg" alt="灾情图片">
</div>

<!--javascript引用-->
<script src="../scripts/ol-debug.js" type="text/javascript"></script>
<script src="../scripts/jquery-1.11.1.min.js" type="text/javascript"></script>
<script src="../scripts/jquery.qtip.min.js" type="text/javascript"></script>
<script src="../scripts/layer/layer.min.js" type="text/javascript"></script>
<script src="../scripts/simulatedData.js" type="text/javascript"></script>
<script src="../plugin/lightbox/js/lightbox.min.js" type="text/javascript"></script>
<!--javascript引用 End-->
<script type="text/javascript">
/**********************************************************
 * 定义全局变量
 **********************************************************/
var projection = {}; //定义使用的投影系
var layers = {
    baseLayers: {},
    vectorLayers: {},
    featureLayers: {},
    clusterLayers: {}
} //定义图层集合
var vectorFeatures = {
    disasterPoint: {
        name: 'disaster',
        type: ol.geom.GeometryType.POINT
    },
    warehousePoint: {
        name: 'warehouse',
        type: ol.geom.GeometryType.POINT
    },
    hiddenTroublePoint: {
        name: 'hiddenTrouble',
        type: ol.geom.GeometryType.POINT
    },
    shelterPoint: {
        name: 'shelter',
        type: ol.geom.GeometryType.POINT
    },
    baseInfoPoint:{
        name: 'baseInfo',
        type: ol.geom.GeometryType.POINT
    },
    expertPoint:{
        name: 'expert',
        type: ol.geom.GeometryType.POINT
    },
    rescueTeamPoint:{
        name: 'rescueTeam',
        type: ol.geom.GeometryType.POINT
    },
    messengerPoint:{
        name: 'messenger',
        type: ol.geom.GeometryType.POINT
    }
}//定义矢量兴趣点类型集合

/**********************************************************
 * 定义页面控件
 **********************************************************/
//定义比例尺
var scaleLineControl = new ol.control.ScaleLine();
//定义鼠标位置
var mousePositionControl = new ol.control.MousePosition({
    coordinateFormat: ol.coordinate.createStringXY(4),
    projection: 'EPSG:4326',
    target: 'mousePosition',
    undefinedHTML: '暂无坐标'
});
// 滑动设置缩放等级
var zoomslider = new ol.control.ZoomSlider();

/**********************************************************
 * 定义视图
 **********************************************************/
var mapView = new ol.View({
    center: ol.proj.transform([116.4437, 39.8771], 'EPSG:4326', 'EPSG:3857'),
    zoom: 6,
    minZoom: 2,
    maxZoom: 25
});

/**********************************************************
 * 定义栅格图层
 **********************************************************/
layers.baseLayers.baseMap = new ol.layer.Tile({
    source: new ol.source.XYZ({
        url: 'http://emap{1-3}.mapabc.com/mapabc/maptile?&x={x}&y={y}&z={z}',
        attributions: [
            new ol.Attribution({
                html: '交付中心 © ' +
                        '<a href="http://www.sinosoft.com.cn/">中科软科技股份有限公司</a>'
            })
        ]
    })
}); //定义底图层

layers.baseLayers.aerialMapBing = new ol.layer.Tile({
    //source: new ol.source.MapQuest({layer: 'sat'})
    source: new ol.source.BingMaps({
        culture: 'zh-cn',
        key: 'AhARYbXRzUHxE7zdTbmnZOiHoa_DK6FdOoq1pFbq6MLiA3qOkMALx7YqmVnjqnBs',
        imagerySet: 'Aerial'
    })
}); //定义卫星图层,使用Bing地图

layers.baseLayers.aerialWithLabelMapBing = new ol.layer.Tile({
    //source: new ol.source.MapQuest({layer: 'sat'})
    source: new ol.source.BingMaps({
        culture: 'zh-cn',
        key: 'AhARYbXRzUHxE7zdTbmnZOiHoa_DK6FdOoq1pFbq6MLiA3qOkMALx7YqmVnjqnBs',
        imagerySet: 'AerialWithLabels'
    })
}); //定义带标注的卫星图层,使用Bing地图

var baseMapGroup = new ol.layer.Group({
    layers: [
        layers.baseLayers.baseMap,
        layers.baseLayers.aerialMapBing,
        layers.baseLayers.aerialWithLabelMapBing
    ]
}); //定义底图组，支持切换不同底图

/**********************************************************
 * 定义矢量图层
 **********************************************************/
var styleCache = {};
//显示行政区划边界矢量数据
layers.vectorLayers.provinceBounds = new ol.layer.Vector({
    source: new ol.source.GeoJSON({
        projection: 'EPSG:3857',
        //url: 'http://localhost/cgi-bin/mapserv?map=/var/www/cgi-bin/mapserver/mapserver_china.map&service=wfs&request=getfeature&version=1.0.0&maxfeatures=50&typename=provinces_simplify&outputformat=application/json'
        url: 'data/geojson/GanSu.geojson'
    }),
    style: function (feature, resolution) {
        var text = resolution < 5000 ? feature.get('name') : '';
        if (!styleCache[text]) {
            styleCache[text] = [new ol.style.Style({
                /*fill: new ol.style.Fill({
                    color: 'rgba(255, 255, 255, 0.6)'
                }),*/
                stroke: new ol.style.Stroke({
                    color: '#319FD3',
                    width: 4
                }),
                text: new ol.style.Text({
                    font: '12px Calibri,sans-serif',
                    text: text,
                    fill: new ol.style.Fill({
                        color: '#000'
                    }),
                    stroke: new ol.style.Stroke({
                        color: '#fff',
                        width: 3
                    })
                })
            })];
        }
        return styleCache[text];
    }
});

//为测量长度和面积准备矢量图层
var source = new ol.source.Vector();

layers.vectorLayers.measureLenAndArea = new ol.layer.Vector({
    source: source,
    style: new ol.style.Style({
        fill: new ol.style.Fill({
            color: 'rgba(255, 255, 255, 0.2)'
        }),
        stroke: new ol.style.Stroke({
            color: '#ffcc33',
            width: 2
        }),
        image: new ol.style.Circle({
            radius: 7,
            fill: new ol.style.Fill({
                color: '#ffcc33'
            })
        })
    })
});

//路径分析使用的矢量图层
layers.vectorLayers.routing = new ol.layer.Vector({
    source: new ol.source.Vector()
});

//灾情标点的矢量图层
layers.featureLayers.disasters = new ol.layer.Vector({
    source: new ol.source.Vector()
});

//物资库矢量图层
layers.featureLayers.warehouses = new ol.layer.Vector({
    source: new ol.source.Vector()
});

//隐患点矢量图层
layers.featureLayers.hiddenTrouble = new ol.layer.Vector({
    source: new ol.source.Vector()
});

//避难场所矢量图层
layers.featureLayers.shelters = new ol.layer.Vector({
    source: new ol.source.Vector()
});

//基础信息矢量图层
layers.featureLayers.baseInfo = new ol.layer.Vector({
    source: new ol.source.Vector()
});

//应急专家矢量图层
layers.featureLayers.expert = new ol.layer.Vector({
    source: new ol.source.Vector()
});

//救援队伍矢量图曾
layers.featureLayers.rescueTeam = new ol.layer.Vector({
    source: new ol.source.Vector()
});

//灾害信息员矢量图层
layers.featureLayers.messenger = new ol.layer.Vector({
    source: new ol.source.Vector()
});

/**********************************************************
 * 定义操作所需的其他元素和层
 **********************************************************/
//定义弹出层使用的元素
var SimpleTipElement = $('<div/>').appendTo($('#map'));
var popupElement = $('<div/>').appendTo($('#map'));

var simpleTip = new ol.Overlay({
    element: SimpleTipElement,
    positioning: 'bottom-center',
    stopEvent: false
});

var popup = new ol.Overlay({
    element: popupElement,
    positioning: 'bottom-center',
    stopEvent: false
});



/**********************************************************
 * 定义操作菜单按钮
 **********************************************************/
$('[title!=""]').qtip(); //使用qtip重新渲染所有title提示

//定义图层切换按钮的点击事件
$('#layerGroupMenuBar>button').click(function () {
    var value = this.value;
    for (key in layers.baseLayers) {
        layers.baseLayers[key].setVisible(key == value ? true : false);
    }
    $.each($('#layerGroupMenuBar>button'), function (index, element) {
        changeStyle(element.id, element.value == value ? 'btnLayerChooseAfterClick' : 'btnLayerChoose');
    });
});//设定按钮切换方法

//定义地图操作按钮展开菜单事件
var mapOperObj = $('#mapOperation').qtip({
    content: {
        title: '地图基本操作',
        text: $('#mapOperation').parent().next(),
        button: 'Close'
    },
    position: {
        my: 'left top',
        adjust: {
            x: 10, y: -12, resize: true
        },
        effect: function(api, pos, viewport) {
            // "this" refers to the tooltip
            $(this).animate(pos, {
                duration: 600,
                easing: 'linear',
                queue: true // Set this to false so it doesn't interfere with the show/hide animations
            });
        }
    },
    style: {
        classes: 'qtip-bootstrap mapOperationPanel'
    },
    show: {
        event: 'click',
        effect: function(/*offset*/) {
            $(this).fadeToggle('fast');
        }
    },
    hide: {
        event: 'click'
    }
});

//定义侧边栏菜单展开事件
$('.left-title-bg').click(function () {
    var $this = $(this),
            url = $this.attr('id'),
            $actionmenu = $('.right-menu[data-url = '+ url +']');
    $('#eastnav-left').animate({'right': '260px'}, 300);
    $('#eastnav-right').animate({'right': '1px'}, 300);
    $('.left-title').removeClass('left-title-selected');
    $this.parents('.left-title').addClass('left-title-selected');
    $('.right-menu').hide();
    $actionmenu.fadeIn();
    $('#exit').fadeIn();
});
$('#exit').click(function () {
    $('#eastnav-left').animate({'right': '0px'}, 300);
    $('#eastnav-right').animate({'right': '-260px'}, 300);
    $('.left-title').removeClass('left-title-selected');
    $('.right-menu').hide();
    $('#exit').fadeOut();
});

//定义侧边栏菜单按钮
$("#chkDisasterLayerShow").click(function(){
    layers.featureLayers.disasters.setVisible($(this).is(':checked') ? true:false);
}).click();//灾情图层
$("#chkWarehouseLayerShow").click(function(){
    layers.featureLayers.warehouses.setVisible($(this).is(':checked') ? true:false);
});//物资库图层
$("#chkHiddenTroubleLayerShow").click(function(){
    layers.featureLayers.hiddenTrouble.setVisible($(this).is(':checked') ? true:false);
});//隐患点
$("#chkSheltersLayerShow").click(function(){
    layers.featureLayers.shelters.setVisible($(this).is(':checked') ? true:false);
});//避难场所图层
$("#chkBaseInfoLayerShow").click(function(){
    layers.featureLayers.baseInfo.setVisible($(this).is(':checked') ? true:false);
    //显示基础信息图层的时候，显示统计指标选项
    $('#basicInfoChoosen').css('display',$(this).is(':checked') ? 'block':'none');
});//基础信息图层
$("#chkExpertLayerShow").click(function(){
    layers.featureLayers.expert.setVisible($(this).is(':checked') ? true:false);
});//应急专家图层
$("#chkRescueTeamLayerShow").click(function(){
    layers.featureLayers.rescueTeam.setVisible($(this).is(':checked') ? true:false);
});//救援队伍信息图层
$("#chkMessengerLayerShow").click(function(){
    layers.featureLayers.messenger.setVisible($(this).is(':checked') ? true:false);
});//灾害信息员信息图层


//定义基础信息侧边栏统计项目链接
$('#lnkPopulationWinShow').click(function(){
    $.layer({
        type: 1,
        title: '人口统计信息',
        area: ['500px', '300px'],
        border: [0], //去掉默认边框
        shade: [0], //去掉遮罩
        closeBtn: [0, true], //去掉默认关闭按钮
        shift: 'left', //从左动画弹出
        page: {
            html: '<div><h1>人口统计信息</h1></div>'
            //dom: '#locateSheltersWindow'
        }
    });
});//人口
$('#lnkFloorAreaWinShow').click(function(){
    $.layer({
        type: 1,
        title: '占地面积统计信息',
        area: ['500px', '300px'],
        border: [0], //去掉默认边框
        shade: [0], //去掉遮罩
        closeBtn: [0, true], //去掉默认关闭按钮
        shift: 'left', //从左动画弹出
        page: {
            html: '<div><h1>占地面积统计信息</h1></div>'
            //dom: '#locateSheltersWindow'
        }
    });
});//占地面积
$('#lnkArableAreaWinShow').click(function(){
    $.layer({
        type: 1,
        title: '耕地面积统计信息',
        area: ['500px', '300px'],
        border: [0], //去掉默认边框
        shade: [0], //去掉遮罩
        closeBtn: [0, true], //去掉默认关闭按钮
        shift: 'left', //从左动画弹出
        page: {
            html: '<div><h1>耕地面积统计信息</h1></div>'
            //dom: '#locateSheltersWindow'
        }
    });
});//耕地面积
$('#lnkGrassLandWinShow').click(function(){
    $.layer({
        type: 1,
        title: '草场面积统计信息',
        area: ['500px', '300px'],
        border: [0], //去掉默认边框
        shade: [0], //去掉遮罩
        closeBtn: [0, true], //去掉默认关闭按钮
        shift: 'left', //从左动画弹出
        page: {
            html: '<div><h1>草场面积统计信息</h1></div>'
            //dom: '#locateSheltersWindow'
        }
    });
});//草场面积
$('#lnkGDPWinShow').click(function(){
    $.layer({
        type: 1,
        title: '生产总值统计信息',
        area: ['500px', '300px'],
        border: [0], //去掉默认边框
        shade: [0], //去掉遮罩
        closeBtn: [0, true], //去掉默认关闭按钮
        shift: 'left', //从左动画弹出
        page: {
            html: '<div><h1>生产总值统计信息</h1></div>'
            //dom: '#locateSheltersWindow'
        }
    });
});//生产总值
$('#lnkAltitudeWinShow').click(function(){
    $.layer({
        type: 1,
        title: '海拔高度统计信息',
        area: ['500px', '300px'],
        border: [0], //去掉默认边框
        shade: [0], //去掉遮罩
        closeBtn: [0, true], //去掉默认关闭按钮
        shift: 'left', //从左动画弹出
        page: {
            html: '<div><h1>海拔高度统计信息</h1></div>'
            //dom: '#locateSheltersWindow'
        }
    });
});//海拔高度

//定义标点定位按钮展开菜单事件
$('.dropdown').mouseenter(function(){
    $('.sublinks').stop(false, true).hide();

    var submenu = $(this).parent().next();

    submenu.css({
        position:'absolute',
        top: $(this).offset().top + $(this).height() + 'px',
        //left: $(this).offset().left + 'px',
        zIndex:1000
    });

    submenu.stop().slideDown(300);

    submenu.mouseleave(function(){
        $(this).slideUp(300);
    });

    submenu.blur(function(){
        $(this).slideUp(300);
    });
});


//定义标点定位的子菜单事件
var disasterWindow, warehouseWindow, hiddenTroubleWindow, sheltersWindow;
$("#locateDisaster").click(function () {
    if(!layers.featureLayers.disasters.getVisible()){
        $("#chkDisasterLayerShow").click();
    }
    if(!disasterWindow) {
        disasterWindow = $.layer({
            type: 1,
            title: '灾害标点',
            area: ['420px', '300px'],
            border: [0], //去掉默认边框
            shade: [0], //去掉遮罩
            closeBtn: [0, true], //去掉默认关闭按钮
            shift: 'top', //从左动画弹出
            offset: ['', '70%'],
            page: {
                dom: '#locateDisasterWindow'
            },
           success: function(layero){
                //重新加载列表
               ;
            },
            close: function(index){
                disasterWindow = null;
            }
        });
    }else{
        ;
    }
});//灾害

$("#locateWarehouse").click(function () {
    if(!layers.featureLayers.warehouses.getVisible()){
        $("#chkWarehouseLayerShow").click();
    }
    if(!warehouseWindow) {
        warehouseWindow = $.layer({
            type: 1,
            title: '物资库标点',
            area: ['420px', '300px'],
            border: [0], //去掉默认边框
            shade: [0], //去掉遮罩
            closeBtn: [0, true], //去掉默认关闭按钮
            shift: 'top', //从左动画弹出
            offset: ['', '70%'],
            page: {
                //html: $('#locateWarehouseWindow').html()
                dom: '#locateWarehouseWindow'
            },
            success: function(layero){
                //重新加载列表
                ;
            },
            close: function(index){
                warehouseWindow = null;
            }
        });
    }else{
        ;
    }
});//物资库

$("#locateHiddenTrouble").click(function () {
    if(!layers.featureLayers.hiddenTrouble.getVisible()){
        $("#chkHiddenTroubleLayerShow").click();
    }
    if(!hiddenTroubleWindow) {
        hiddenTroubleWindow = $.layer({
            type: 1,
            title: '地质灾害隐患点标点',
            area: ['420px', '260px'],
            border: [0], //去掉默认边框
            shade: [0], //去掉遮罩
            closeBtn: [0, true], //去掉默认关闭按钮
            shift: 'top', //从左动画弹出
            offset: ['', '70%'],
            page: {
                //html: $('#locateHiddenTroubleWindow').html()
                dom: '#locateHiddenTroubleWindow'
            },
            success: function(layero){
                //重新加载列表
                ;
            },
            close: function(index){
                hiddenTroubleWindow = null;
            }
        });
    }else{
        ;
    }
});//隐患点

$("#locateShelters").click(function () {
    if(!layers.featureLayers.shelters.getVisible()){
        $("#chkSheltersLayerShow").click();
    }
    if(!sheltersWindow) {
        sheltersWindow = $.layer({
            type: 1,
            title: '避难场所标点',
            area: ['420px', '260px'],
            border: [0], //去掉默认边框
            shade: [0], //去掉遮罩
            closeBtn: [0, true], //去掉默认关闭按钮
            shift: 'top', //从左动画弹出
            offset: ['', '70%'],
            page: {
                //html: $('#locateSheltersWindow').html()
                dom: '#locateSheltersWindow'
            },
            success: function(layero){
                //重新加载列表
                ;
            },
            close: function(index){
                sheltersWindow = null;
            }
        });
    }else{
        ;
    }
});//避难场所

$('#disasterLocate').click(function(){
    var ifChecked = $('input:radio[name="locDisaster"]:checked').length;
    if(!ifChecked){
        layer.alert('请选择一个灾情进行标点',0,'未选择');
        return;
    }
    featurePlot(vectorFeatures.disasterPoint);
});//灾情

$('#warehouseLocate').click(function(){
    var ifChecked = $('input:radio[name="locWarehouse"]:checked').length;
    if(!ifChecked){
        layer.alert('请选择一个物资库进行标点',0,'未选择');
        return;
    }
    featurePlot(vectorFeatures.warehousePoint);
});//物资库

$('#hiddenTroubleLocate').click(function(){
    var ifChecked = $('input:radio[name="locHiddenTrouble"]:checked').length;
    if(!ifChecked){
        layer.alert('请选择一个隐患点进行标点',0,'未选择');
        return;
    }
    featurePlot(vectorFeatures.hiddenTroublePoint);
});//隐患点

$('#sheltersLocate').click(function(){
    var ifChecked = $('input:radio[name="locShelters"]:checked').length;
    if(!ifChecked){
        layer.alert('请选择一个避难场所进行标点',0,'未选择');
        return;
    }
    featurePlot(vectorFeatures.shelterPoint);
});//避难场所

//灾情列表选择按钮事件
$('table input[name="slecDisaster"]').click(function(){
    $(popupElement).qtip('hide');
    if($(this).is(':checked')){
        //alert(getDisaster($(this).val()).getGeometry().getCoordinates());
        var disaster = getDisaster($(this).val());
        var coord = disaster.getGeometry().getCoordinates();
        map.beforeRender(new ol.animation.pan({
                    duration: 2000,
                    source: mapView.getCenter(),
                    start: +new Date()
                }),
                new ol.animation.bounce({
                    duration: 2000,
                    resolution: mapView.getZoom() * mapView.getResolution(),
                    start: +new Date()
                }));
        mapView.setCenter(coord);
        mapView.setZoom(13);
        //定位到灾情后，自动弹出灾情详细信息
        popup.setPosition(coord);
        setTimeout(function(){
            $(popupElement).qtip({
                content: {
                    title: disaster.get('name'),
                    text: disaster.get('text'),
                    button: 'Close'
                },
                position: {
                    my: 'bottom center',
                    adjust: {
                        x: 0, y: -10, resize: true
                    }
                },
                style: {
                    classes: 'qtip-bootstrap'
                },
                hide: {
                    event: false
                }

            }).qtip('show')
        },3000);
    }
});


/**********************************************************
 * 定义测量长度和面积的方法 example from measure.js
 * on openlayers.org
 * 设定测量长度和面积的操作按钮
 **********************************************************/
/**
 * Currently drawed feature
 * @type {ol.Feature}
 */
var sketch;

/**
 * Element for currently drawed feature
 * @type {Element}
 */
var sketchElement;

var output;
/**
 * handle pointer move
 * @param {Event} evt
 */
var mouseMoveHandler = function(evt) {
    if (sketch) {
        //var output;
        var geom = (sketch.getGeometry());
        if (geom instanceof ol.geom.Polygon) {
            output = formatArea(/** @type {ol.geom.Polygon} */ (geom));

        } else if (geom instanceof ol.geom.LineString) {
            output = formatLength( /** @type {ol.geom.LineString} */ (geom));
        }
    }
};

/**
 * format length output
 * @param {ol.geom.LineString} line
 * @return {string}
 */
//var output;

var formatLength = function(line) {
    //var output;
    var length = Math.round(line.getLength() * 100) / 100;
    if (length > 100) {
        output = '测量距离为：' + (Math.round(length / 1000 * 100) / 100) +
            //' ' + 'km';
                ' ' + '公里';
    } else {
        output = '测量距离为：' + (Math.round(length * 100) / 100) +
            //' ' + 'm';
                ' ' + '米';
    }
    return output;
};

/**
 * format length output
 * @param {ol.geom.Polygon} polygon
 * @return {string}
 */
var formatArea = function(polygon) {
    var area = polygon.getArea();
    //var output
    if (area > 10000) {
        output = '测量面积为：' + (Math.round(area / 1000000 * 100) / 100) +
            //' ' + 'km<sup>2</sup>';
                ' ' + '平方公里';
    } else {
        output = '测量面积为：' + (Math.round(area * 100) / 100) +
            //' ' + 'm<sup>2</sup>';
                ' ' + '平方米';
    }
    return output;
};

var draw; // global so we can remove it later
function addInteraction(measureType) {
    draw = new ol.interaction.Draw({
        source: layers.vectorLayers.measureLenAndArea.getSource(),
        type: /** @type {ol.geom.GeometryType} */ measureType
    });
    map.addInteraction(draw);

    draw.on('drawstart',
            function(evt) {
                // set sketch
                sketch = evt.feature;
                sketchElement = null;
            }, this);

    draw.on('drawend',
            function(evt) {
                // unset sketch
                sketch = null;
                sketchElement = null;
                map.removeInteraction(draw);
                alert(output);
            }, this);
}

//定义测量距离按钮
$('#measureDistance').click(function(){
    //map.removeInteraction(draw);
    addInteraction(ol.geom.GeometryType.LINE_STRING);
});
//定义测量面积按钮
$('#measureArea').click(function(){
    //map.removeInteraction(draw);
    addInteraction(ol.geom.GeometryType.POLYGON);
});


/**********************************************************
 * 定义绘制点、线、圆、多边形的方法
 * 初始化相应地图操作按钮
 **********************************************************/

function drawSometing(drawType) {
    draw = new ol.interaction.Draw({
        source: layers.vectorLayers.measureLenAndArea.getSource(),
        type: /** @type {ol.geom.GeometryType} */ (drawType)
    });
    map.addInteraction(draw);

    draw.on('drawend',
            function(evt) {
                // unset sketch
                map.removeInteraction(draw);
            }, this);
}
//画点
$('#drawPoint').click(function(){
    drawSometing("Point");
});
//画线
$('#drawLine').click(function(){
    drawSometing("LineString");
});
//画多边形
$('#drawPoly').click(function(){
    drawSometing("Polygon");
});

/**********************************************************
 * 定义路径规划的方法
 * 初始化相应地图操作按钮
 **********************************************************/
var routingParam = {};

routingParam.requestParam = {
    LAYERS: 'GanSuGIS:lanzhou_road',
    FORMAT: 'image/png'
};

routingParam.transform = ol.proj.getTransform('EPSG:3857','EPSG:4326');

routingParam.startPoint = new ol.Feature({});
routingParam.endPoint = new ol.Feature();


routingParam.startPointStyle = new ol.style.Style({
    image: new ol.style.Icon(/* @type {olx.style.IconOptions}*/ ({
        anchor: [0.5, 60],
        anchorXUnits: 'fraction',
        anchorYUnits: 'pixels',
        opacity: 0.75,
        src: 'data/icon/routing_start.png'
    }))
});

routingParam.endPointStyle = new ol.style.Style({
    image: new ol.style.Icon(/* @type {olx.style.IconOptions}*/ ({
        anchor: [0.5, 60],
        anchorXUnits: 'fraction',
        anchorYUnits: 'pixels',
        opacity: 0.75,
        src: 'data/icon/routing_end.png'
    }))
});

routingParam.startPoint.setStyle(routingParam.startPointStyle);
routingParam.endPoint.setStyle(routingParam.endPointStyle);


layers.vectorLayers.routing.getSource().addFeatures([routingParam.startPoint,routingParam.endPoint]);

routingParam.result = null;

$('#routing').click(function (){

    map.on('click', function(evt){

        if(!routingParam.startPoint.getGeometry()){
            //第一次点击,在点击处标一个点
            routingParam.startPoint.setGeometry(new ol.geom.Point(evt.coordinate));
        }else if(!routingParam.endPoint.getGeometry()){
            //第二次点击
            routingParam.endPoint.setGeometry(new ol.geom.Point(evt.coordinate));

            var startCoord = routingParam.transform(routingParam.startPoint.getGeometry().getCoordinates());
            var endCoord = routingParam.transform(routingParam.endPoint.getGeometry().getCoordinates());
            var viewparams = [
                    'x1:' + startCoord[0], 'y1:' + startCoord[1],
                    'x2:' + endCoord[0], 'y2:' + endCoord[1]
            ];
            routingParam.requestParam.viewparams = viewparams.join(';');
            routingParam.result = new ol.layer.Image({
                source: new ol.source.ImageWMS({
                    //url: 'http://localhost:8080/geoserver/GanSuGIS/wms',
                    url: 'http://192.168.56.111:8080/geoserver/GanSuGIS/wms',
                    params: routingParam.requestParam
                })
            });
            map.addLayer(routingParam.result);
        }
    });
});

$('#clearRouting').click(function (){
    map.removeLayer(routingParam.result);
    routingParam.startPoint.setGeometry(null);
    routingParam.endPoint.setGeometry(null);


});


/**********************************************************
 * 合成地图、初始化操作
 **********************************************************/
var map = new ol.Map({
    controls: ol.control.defaults({
        attributionOptions: ({
            collapsible: true
        })
    }).extend([
        zoomslider,
        scaleLineControl,
        mousePositionControl
    ]),
    layers: [
        baseMapGroup,
        layers.vectorLayers.provinceBounds,
        layers.vectorLayers.measureLenAndArea,
        layers.vectorLayers.routing,
        layers.featureLayers.disasters,
        layers.featureLayers.warehouses,
        layers.featureLayers.hiddenTrouble,
        layers.featureLayers.shelters,
        layers.featureLayers.baseInfo,
        layers.featureLayers.expert,
        layers.featureLayers.rescueTeam,
        layers.featureLayers.messenger
    ],
    view: mapView,
    target: 'map'
});

$.each($('button.btnLayerChoose'), function () {
    if (this.value == 'baseMap') {
        this.click();
    }
})//图层选择按钮初始化设定，默认显示行政区划地图

//layers.vectorLayers.provinceBounds.setVisible(false); //默认不显示矢量图层
layers.featureLayers.hiddenTrouble.setVisible(false);
layers.featureLayers.warehouses.setVisible(false);
layers.featureLayers.shelters.setVisible(false);
layers.featureLayers.baseInfo.setVisible(false);
layers.featureLayers.expert.setVisible(false);
layers.featureLayers.rescueTeam.setVisible(false);
layers.featureLayers.messenger.setVisible(false);

$(map.getViewport()).on('mousemove', mouseMoveHandler); //绑定测量长度和面积方法
map.addOverlay(simpleTip);//绑定弹出层
map.addOverlay(popup);//绑定弹出层

//http://localhost/cgi-bin/mapserv?map=/var/www/cgi-bin/mapserver/mapserver_china.map&service=wfs&request=getfeature&version=1.0.0&maxfeatures=50&typename=provinces_simplify&outputformat=application/json

/**********************************************************
 * 绑定鼠标业务菜单操作
 **********************************************************/
/*$('#map').click(function (e) {
    var $items = $('.radius');
    $items.removeClass('radius-scale');
    setTimeout(function () {
        showItem($items, 0, e);
    }, 200)

});

function bindEvent() {
    var isMousedown = false,
            isClick = true;
    $(document).on('mousedown', function (e) {
        isMousedown = true;
    });

    $(document).mousemove( function () {
        if (isMousedown) {
            isClick = false;
        }
    });

    $(document).mouseup( function (e) {
        if (isMousedown && isClick) {
            isMousedown = false;
            var $items = $('.radius');
            $items.removeClass('radius-scale');
            setTimeout(function() {
                showItem($items, 0 , e);
            }, 200);
        }
        resetStatus();
        function resetStatus () {
            isMousedown = false;
            isClick = true;
        }
    });
}*/

$('.radius').click(function (e) {
    e.stopPropagation();
});

//鼠标菜单失去焦点自动隐藏
$('.radius').blur(function (e) {
    $('.radius').removeClass('radius-scale');
});

function showItem($items, index, e) {
    var //x = e.clientX,
            //y = e.clientY,
            x= e.pixel[0],
            y= e.pixel[1],
            left,
            top,
            taskId;
    switch (index) {
        case 0:
            left = x - 75;
            top = y - 15;
            break;
        case 1:
            left = x - 58;
            top = y - 57;
            break;
        case 2:
            left = x - 15;
            top = y - 75;
            break;
        case 3:
            left = x + 28;
            top = y - 57;
            break;
        case 4:
            left = x + 45;
            top = y - 15;
            break;
        case 5:
            left = x + 28;
            top = y + 27;
            break;
        case 6:
            left = x - 15;
            top = y + 45;
            break;
        case 7:
            left = x - 58;
            top = y + 27;
            break;
    }

    $($items.get(index)).css({
        'left': left,
        'top': top
    }).addClass('radius-scale');

    if (index < $items.length - 1) {
      taskId = setTimeout(function () {
        showItem($items, ++index, e)
      }, 50);
    } else {
       showArrow(x,y);
    }
}

function showArrow(x,y) {

    var left,top;
    $('#bizDisaster .arrow').each(function(index, item) {
      switch (index) {
        case 0:
          left = x - 62;
          top = y - 30;
          break;
        case 1:
          left = x - 31;
          top = y - 63;
          break;
        case 2:
          left = x + 17;
          top = y - 63;
          break;
        case 3:
          left = x + 48;
          top = y - 29;
          break;
        case 4:
          left = x + 50;
          top = y + 13;
          break;
        case 5:
          left = x + 17;
          top = y + 48;
          break;
        case 6:
          left = x - 33;
          top = y + 53;
          break;
      }
      $(item).css({
        "left": left,
        "top": top
      });
      $(item).show(200);

    });
}

//查看灾情详细信息
var disasterInfo, disasterAnalysis;
$('.fa-bars').click(function(){
        if(!disasterInfo) {
            disasterInfo = $.layer({
                type: 1,
                title: '灾情详细信息',
                area: ['1200px', '430px'],
                border: [0], //去掉默认边框
                shade: [0], //去掉遮罩
                closeBtn: [0, true], //去掉默认关闭按钮
                shift: 'top', //从左动画弹出
                /*offset: ['', '70%'],*/
                page: {
                    html: '<iframe src="zqxxzs/zqxx.html" frameborder="0" style="height:460px;width:1200px;"></iframe>'
                    //dom: '#locateSheltersWindow'
                    //url:'zqxxzs/zqxx.html'
                },
                success: function(layero){
                    //重新加载列表
                    ;
                },
                close: function(index){
                    disasterInfo = null;
                }
            });
        }else{
        ;
    }
});

//决策
$('.fa-users').click(function(){
    if(!disasterAnalysis) {
        disasterAnalysis = $.layer({
            type: 1,
            title: '决策',
            area: ['1000px', '500px'],
            border: [0], //去掉默认边框
            shade: [0], //去掉遮罩
            closeBtn: [0, true], //去掉默认关闭按钮
            shift: 'top', //从左动画弹出
            /*offset: ['', '70%'],*/
            page: {
                url:'zqxxzs/jc.html'//救灾工作
            },
            success: function(layero){
                //重新加载列表
                ;
            },
            close: function(index){
                disasterAnalysis = null;
            }
        });
    }else{
        ;
    }
});

//查看涉灾部门数据
$('.fa-cubes').click(function(){
    if(!disasterAnalysis) {
        disasterAnalysis = $.layer({
            type: 1,
            title: '查看涉灾部门数据',
            area: ['1000px', '350px'],
            border: [0], //去掉默认边框
            shade: [0], //去掉遮罩
            closeBtn: [0, true], //去掉默认关闭按钮
            shift: 'top', //从左动画弹出
            /*offset: ['', '70%'],*/
            page: {
                html: '<iframe src="zqxxzs/szbmxx.html" frameborder="0" style="height:500px;width:1000px;"></iframe>'
            },
            success: function(layero){
                //重新加载列表
                ;
            },
            close: function(index){
                disasterAnalysis = null;
            }
        });
    }else{
        ;
    }
});

//查看受灾地需求信息
$('.fa-cloud').click(function(){
    if(!disasterInfo) {
        disasterInfo = $.layer({
            type: 1,
            title: '受灾地需求详细信息',
            area: ['660px', '360px'],
            border: [0], //去掉默认边框
            shade: [0], //去掉遮罩
            closeBtn: [0, true], //去掉默认关闭按钮
            shift: 'top', //从左动画弹出
            /*offset: ['', '70%'],*/
            page: {
                html: '<iframe src="jzxq/jzxqxx.html" frameborder="0" style="height:350px;width:655px;"></iframe>'
                //dom: '#locateSheltersWindow'
                //url:'jzxq/jzxqxx.html'
            },
            success: function(layero){
                //重新加载列表
                ;
            },
            close: function(index){
                disasterInfo = null;
            }
        });
    }else{
        ;
    }
});
//查看受灾地救灾工作
$('.fa-envelope').click(function(){
    if(!disasterAnalysis) {
        disasterAnalysis = $.layer({
            type: 1,
            title: '受灾地救灾工作',
            area: ['1200px', '480px'],
            border: [0], //去掉默认边框
            shade: [0], //去掉遮罩
            closeBtn: [0, true], //去掉默认关闭按钮
            shift: 'top', //从左动画弹出
            /*offset: ['', '70%'],*/
            page: {
                html: '<iframe src="zqxxzs/jzgz.html" frameborder="0" style="height:460px;width:1200px;"></iframe>'
               // url:'zqxxzs/jzgz.html'//救灾工作
            },
            success: function(layero){
                //重新加载列表
                ;
            },
            close: function(index){
                disasterAnalysis = null;
            }
        });
    }else{
        ;
    }
});

//查看灾情研判信息
$('.fa-newspaper-o').click(function(){
    if(!disasterAnalysis) {
        disasterAnalysis = $.layer({
            type: 1,
            title: '灾情综合研判',
            area: ['850px', '500px'],
            border: [0], //去掉默认边框
            shade: [0], //去掉遮罩
            closeBtn: [0, true], //去掉默认关闭按钮
            shift: 'top', //从左动画弹出
            /*offset: ['', '70%'],*/
            page: {
                html: '<iframe src="zqyp/zqypxx.html" frameborder="0" style="height:464px;width:850px;"></iframe>'
                //dom: '#locateSheltersWindow'
            },
            success: function(layero){
                //重新加载列表
                ;
            },
            close: function(index){
                disasterAnalysis = null;
            }
        });
    }else{
        ;
    }
});

//显示灾情图片
layer.use('extend/layer.ext.js');
$('.fa-picture-o').click(function(){
    layer.photos({
        html: '' ,   //自定义的html，显示在层右侧
        tab: function(obj){}, //图片切换操作的回调，obj返回了图片pid和name
       /* json: { //您服务端接口需严格按照下述格式返回
            "status": 1,    //请求的状态，1表示成功，其它表示失败
            "msg": "",  //状态提示语
            "title": "灾情图片",    //相册标题
            "id": 1,    //相册id
            "start": 0, //初始显示的图片序号，默认0
            "data": [   //相册包含的图片，数组格式
                {
                    "name": "", //图片名
                    "pid": 1, //图片id
                    "src": "data/picture/1.jpg", //原图地址
                    "thumb": "data/picture/1.jpg", //缩略图地址
                    "area": [638, 851] //原图宽高
                }
            ]
        }*/
        page: { //直接获取页面指定区域的图片，他与上述异步不可共存，只能择用其一。
            parent: '#imgs' , //图片的父元素选择器，如'#imsbox',
            start: 0, //初始显示的图片序号，默认0
            title: '灾情图片' //相册标题
        },
        shade: [0]
    });
});

//显示视频
$('.fa-film').click(function () {
    var i = $.layer({
        type : 1,
        title : false,
        fix : false,
        border: false,
        offset:['50px' , ''],
        area : ['448px','336px'],
        page : {
            html : '<video src="data/video/1.mp4" controls="controls">您的浏览器不支持video标签</video>'
        }
    });
});

//查询周边
$('.fa-search').click(function(){
    if(!disasterAnalysis) {
        disasterAnalysis = $.layer({
            type: 1,
            title: '查询灾情周边',
            area: ['550px', '400px'],
            border: [0], //去掉默认边框
            shade: [0], //去掉遮罩
            closeBtn: [0, true], //去掉默认关闭按钮
            shift: 'top', //从左动画弹出
            /*offset: ['', '70%'],*/
            page: {
                dom: '#pageCxzb'
            },
            success: function(layero){
                //重新加载列表
                ;
            },
            close: function(index){
                disasterAnalysis = null;
            }
        });
    }else{
        ;
    }
});

//取消按钮
$('.fa-close').click(function(){
    $('.radius').removeClass('radius-scale');
});

//

/**********************************************************
 * 公共方法
 **********************************************************/
function changeStyle(domId, styleName) {
    $("#" + domId).removeClass();
    $("#" + domId).addClass(styleName);
}//改变图层选择按钮的选中样式

function changeFeaturesLayerShown(layerkeys, ifShow){

}//改变layers.features图层的显示与否，并控制相应checkbox按钮是否选中


//图片展示
function showImages (options){
    if ($("#imagesArea").length > 0){
        $("#imagesArea").empty();
    } else {
        $("body").append('<div id="imagesArea" style="display: none;z-index: 19891017"></div>');
    }
    $.each(options.images,function(){
        $('<a>').attr({
            "href" : this.href,
            "data-lightbox" : this.group || "group1",
            "data-title": this.title || "默认"
        }).appendTo($("#imagesArea"));
    });
    if (options.defaultShow){
        $("#imagesArea a[data-title=" + options.defaultShow + "]").click();
    } else {
        $("#imagesArea a").first().click();
    }
}
/**********************************************************
 * 矢量图层操作
 **********************************************************/
/*var highlightStyleCache = {};

var featureOverlay = new ol.FeatureOverlay({
    map: map,
    style: function (feature, resolution) {
        var text = resolution < 5000 ? feature.get('name') : '';
        if (!highlightStyleCache[text]) {
            highlightStyleCache[text] = [new ol.style.Style({
                stroke: new ol.style.Stroke({
                    color: '#f00',
                    width: 1
                }), 
                fill: new ol.style.Fill({
                    color: 'rgba(255,0,0,0.1)'
                }),
                text: new ol.style.Text({
                    font: '12px Calibri,sans-serif',
                    text: text,
                    fill: new ol.style.Fill({
                        color: '#000'
                    }),
                    stroke: new ol.style.Stroke({
                        color: '#f00',
                        width: 3
                    })
                })
            })];
        }
        return highlightStyleCache[text];
    }
});

var highlight;
var displayFeatureInfo = function (pixel) {

    var feature = map.forEachFeatureAtPixel(pixel, function (feature, layer) {
        return feature;
    });

    if (feature) {
        //alert(feature.get('Area') + ': ' + feature.get('Name_CHN'));
    }

    if (feature !== highlight) {
        if (highlight) {
            featureOverlay.removeFeature(highlight);
        }
        if (feature) {
            featureOverlay.addFeature(feature);
        }
        highlight = feature;
    }

};

$(map.getViewport()).on('mousemove', function (evt) {
    var pixel = map.getEventPixel(evt.originalEvent);
    displayFeatureInfo(pixel);
});

map.on('click', function (evt) {
    displayFeatureInfo(evt.pixel);
});*/

/*=============================以下是界面原型演示效果==========================================*/
//聚焦到甘肃
function bounce(t) {
    var s = 7.5625, p = 2.75, l;
    if (t < (1 / p)) {
        l = s * t * t;
    } else {
        if (t < (2 / p)) {
            t -= (1.5 / p);
            l = s * t * t + 0.75;
        } else {
            if (t < (2.5 / p)) {
                t -= (2.25 / p);
                l = s * t * t + 0.9375;
            } else {
                t -= (2.625 / p);
                l = s * t * t + 0.984375;
            }
        }
    }
    return l;
}

var GanSu = ol.proj.transform([103.8486, 36.8927], 'EPSG:4326', 'EPSG:3857');
var duration = 4000;
var start = +new Date();
var pan = ol.animation.pan({
    duration: duration,
    source: /** @type {ol.Coordinate} */ (mapView.getCenter()),
    start: start
});
var bounce = ol.animation.bounce({
    duration: duration,
    resolution: 6 * mapView.getResolution(),
    start: start
});

var rotate = ol.animation.rotate({
    duration: duration,
    rotation: 2 * Math.PI,
    start: start
});

setTimeout(function(){
    map.beforeRender(pan);
    mapView.setCenter(GanSu);
}, 2000);

//构建模拟数据
simulatedData();


// display popup on click
map.on('click', function(evt) {
    $('.radius').removeClass('radius-scale'); //先清除一下鼠标菜单
    var feature = map.forEachFeatureAtPixel(evt.pixel,
            function(feature, layer) {
                return feature;
            });
    if(feature) {
        /*if (feature.get('type').type = ol.geom.GeometryType.POINT) {
        var geometry = feature.getGeometry();
        var coord = geometry.getCoordinates();
        simpleTip.setPosition(coord);
       */
        /* $(SimpleTipElement).qtip({
            content: {
                title: feature.get('name'),
                text: feature.get('name')
            }
        });
        $(SimpleTipElement).qtip('show');*/
        /*
            var $items = $('.radius');
            //$items.hide();
            $items.removeClass('radius-scale');
            setTimeout(function() {
                showItem($items, 0 , evt);
            }, 200)

    } else if(){
    else
    } {
        //$(SimpleTipElement).qtip('hide');
        $('.radius').removeClass('radius-scale');
    }*/  //改成CASE
        switch (feature.get('type')){
            case vectorFeatures.disasterPoint:
            {
                var $items = $('.radius');
                //$items.hide();
                $('#bizDisaster .arrow').hide(0);
                $items.removeClass('radius-scale');

                setTimeout(function () {
                    showItem($items, 0, evt);
                }, 200);
                break;
            }
            case vectorFeatures.warehousePoint:
            {
/*                var geometry = feature.getGeometry();
                var coord = geometry.getCoordinates();
                popup.setPosition(coord);
                $(popupElement).qtip({
                    content: {
                        title: feature.get('name'),
                        text: feature.get('text'),
                        button: 'Close'
                    },
                    position: {
                        my: 'bottom center',
                        adjust: {
                            x: 0, y: -10, resize: true
                        }
                    },
                    style: {
                        classes: 'qtip-bootstrap'
                    },
                    hide: {
                        event: false
                    }

                }).qtip('show');*/
                //物资储备库
                $.layer({
                    type: 1,
                    title: '物资储备库',
                    area: ['1000px', '300px'],
                    border: [0], //去掉默认边框
                    shade: [0], //去掉遮罩
                    closeBtn: [0, true], //去掉默认关闭按钮
                    shift: 'top', //从左动画弹出
                    page: {
                        html: '<iframe src="wzcbk/wzcbk.html" frameborder="0" style="height:290px;width:1000px;"></iframe>'
                        //dom: '#locateSheltersWindow'
                    }
                });
                break;
            }
            case vectorFeatures.hiddenTroublePoint:
                ;
            case vectorFeatures.shelterPoint:
            {
                $.layer({
                    type: 1,
                    title: '应急避难场所',
                    area: ['800px', '300px'],
                    border: [0], //去掉默认边框
                    shade: [0], //去掉遮罩
                    closeBtn: [0, true], //去掉默认关闭按钮
                    shift: 'top', //从左动画弹出
                    page: {
                        html: '<iframe src="yjbns/yjbns.html" frameborder="0" style="height:300px;width:800px;"></iframe>'
                    }
                });
                break;
            }
            case vectorFeatures.baseInfoPoint:
                ;
            case vectorFeatures.expertPoint:
            {
                $.layer({
                    type: 1,
                    title: '应急专家',
                    area: ['800px', '280px'],
                    border: [0], //去掉默认边框
                    shade: [0], //去掉遮罩
                    closeBtn: [0, true], //去掉默认关闭按钮
                    shift: 'top', //从左动画弹出
                    page: {
                        html: '<iframe src="yjzj/yjzjView.html" frameborder="0" style="height:245px;width:800px;"></iframe>'
                    }
                });
                break;
            }
            case vectorFeatures.rescueTeamPoint:
            {
                $.layer({
                    type: 1,
                    title: '应急队伍',
                    area: ['900px', '300px'],
                    border: [0], //去掉默认边框
                    shade: [0], //去掉遮罩
                    closeBtn: [0, true], //去掉默认关闭按钮
                    shift: 'top', //从左动画弹出
                    page: {
                        html: '<iframe src="yjdw/jydw.html" frameborder="0" style="height:300px;width:900px;"></iframe>'
                    }
                });
                break;
            }
            case vectorFeatures.messengerPoint:
            {
                $.layer({
                    type: 1,
                    title: '灾害信息员',
                    area: ['900px', '350px'],
                    border: [0], //去掉默认边框
                    shade: [0], //去掉遮罩
                    closeBtn: [0, true], //去掉默认关闭按钮
                    shift: 'top', //从左动画弹出
                    page: {
                        html: '<iframe src="zhxxy/zhxxy.html" frameborder="0" style="height:350px;width:900px;"></iframe>'
                    }
                });
                break;
            }
            default :
                $('.radius').removeClass('radius-scale');
        }
    }
});

//鼠标划过兴趣点的时候改变样式
//TODO mousemove事件过于频繁的触发，导致提示框不停的显示、消失，正式开发时修正该BUG
$(map.getViewport()).on('mousemove', function (e) { //mousemove事件并不适合用于显示元素信息，而只适用于鼠标形态改变
    var pixel = map.getEventPixel(e.originalEvent);
    var feature = map.forEachFeatureAtPixel(pixel, function (feature, layer) {
        return feature;
    });

    if (feature && feature.get('type')) {
        $('#map').addClass('mouse_cursor');
        var geometry = feature.getGeometry();
        var coord = geometry.getCoordinates();
        simpleTip.setPosition(coord);
        $(SimpleTipElement).qtip({
            content: {
                text: feature.get('name')
            },
            position: {
                my: 'left top',
                adjust: {
                    x: 10, y: -12, resize: true
                }
            },
            style: {
                classes: 'qtip-bootstrap'
            }
        });
        //console.error(e.target);
        $(SimpleTipElement).qtip('show');
    } else {
        $('#map').removeClass('mouse_cursor');
        $(SimpleTipElement).qtip('hide');
    }
});



/*****************************************************************************/

</script>
</body>
</html>
